server {
  listen 443 ssl http2;
  server_name _;

  ssl_certificate     /etc/ssl/cf-origin/$ssl_server_name.pem;
  ssl_certificate_key /etc/ssl/cf-origin/$ssl_server_name.key;

  ##
  # Cloudflare real IP (generated by updater)
  ##
  include /etc/nginx/conf.d/cloudflare-realip.conf;

  root /var/www/wordpress;
  index index.php;

  client_max_body_size 32m;

  ##
  # Security headers (origin-safe)
  ##
  add_header X-Frame-Options "SAMEORIGIN" always;
  add_header X-Content-Type-Options "nosniff" always;
  add_header Referrer-Policy "strict-origin-when-cross-origin" always;
  add_header Permissions-Policy "interest-cohort=()" always;
  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

  ##
  # Hard blocks
  ##
  location = /xmlrpc.php { return 444; }
  location ~* /(wp-config\.php|readme\.html|license\.txt) { return 404; }
  location ~ /\. { return 404; }

  ##
  # Main routing
  ##
  location / {
    limit_req zone=req_per_ip burst=20 nodelay;
    try_files $uri $uri/ /index.php?$args;
  }

  ##
  # PHP
  ##
  location ~ \.php$ {
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    fastcgi_param HTTPS on;
    fastcgi_param HTTP_PROXY "";
    fastcgi_read_timeout 60;
    fastcgi_pass unix:/run/php/php-fpm.sock;
  }

  ##
  # Static assets (Cloudflare will cache)
  ##
  location ~* \.(?:css|js|jpg|jpeg|gif|png|svg|ico|webp|woff2?|ttf)$ {
    expires 30d;
    add_header Cache-Control "public, max-age=2592000, immutable";
    access_log off;
    try_files $uri =404;
  }
}
